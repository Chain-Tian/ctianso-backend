# 聚合 - 第二期

## Mission

1. 获取多种不同类型的数据源
   a. 文章 - 内部
   b. 用户 - 内部
   c. 图片 - 外部
2. 前后端搜索接口联调,跑通整个页面
3. 分析现有问题 => 优化
4. 提前装ES

## Mission-1 获取不同类型的数据源

### 文章

- 获取文章 => 爬虫

抓取： https://www.code-nav.cn/learn/passage

#### 数据抓取方式

1、直接请求数据接口

2、等网页渲染出明文后，直接从前端页面抓取

3、有一些浏览器有动态请求（ 例如人机验证 ） => 无头浏览器： selenium、node.js puppeteer

##### 关于job包里的once任务

解释：

- 实现了 `CommandLineRunner` 接口，就要实现他的run方法
- 然后通过将其放在Spring容器中，就会在项目启动时，运行一次任务

```java
// todo 取消注释开启任务
//@Component
@Slf4j
public class FullSyncPostToEs implements CommandLineRunner {

    @Resource
    private PostService postService;

    @Resource
    private PostEsDao postEsDao;

    @Override
    public void run(String... args) {
        // your mission （一次性任务）
    }
}
```

### 用户

- 获取用户 - 就是自己的用户

### 图片

- 获取图片 - 实时抓取：不存数据，需要的时候再去查

jsoup库： 坑： 1.15.4 查不了（1.16可以）

```xml
<!--        jsoup-->
<dependency>
    <groupId>org.jsoup</groupId>
    <artifactId>jsoup</artifactId>
    <version>1.16.1</version>
</dependency>
```

## Mission2 - 前后端联调,跑通页面 + 问题分析

- 问题:
    - 目前在加载的时候,调用三个接口分别获取文章、图片、用户数据
- 解决：
    - 实际上，要根据不同业务场景去解决
        - 1） 可以设置：点啥搜啥，点图片搜图片，点用户搜用户
        - 2） 如果是针对聚合内容的页面，其实可以一个请求搞定
        - 3） 有可能还要查询其他额外信息（例如数据总数、同时给用户反馈）
         
**根据实际情况去选择方式**

本次问题：
1. 请求数量多，可能受到浏览器限制 => 用一个接口请求完所有数据
2. 请求不同接口的参数不一致，增加前后端成本
3. 前端代码有点多，而且重复

## Mission3 - 聚合接口

1. 请求数量多，可能受到浏览器限制 => 用一个接口请求完所有数据

2. 请求不同接口的参数不一致，增加前后端成本 => 一个接口实现参数统一

3. 前端代码有点多，而且重复 => 用一个接口，通过不同参数区分查询的数据
（**门面模式？？？**）