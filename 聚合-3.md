# 聚合 - 第三期

## 目录

1、聚合接口优化（ 支持前端更灵活取数据 ）
2、从0开始Elastic Stack
3、数据同步

### 聚合接口优化

让前端既能一次性搜索出所有数据,又能分别获取某一数据

① 给SearchRequest添加type字段

#### 门面模式

② 根据type的值，

- 空 -> 全查询
- 非空 -> 定查询
  设计好之后：用的switch - case

#### 适配器模式

发现问题: Type增多（即加入新的搜索模块时），代码堆积

### ES的几种调用方式

1 ) Restful API (http请求)

GET "localhost:9200/?pretty"

ES端口:

- 9200: 给外部用户访问
- 9300: 给ES集群内部通信 (外部调用不了)

2 ) Kibana devtools
自由地对ES进行操作 ( 本质也是Restful api )

### ES语法 

#### DSL - 领域特定语言

##### 建表 + 插入数据

```json
POST logs-my_app-default/_doc
{
  "title": "测试",
  "@timestamp": "2099-05-06T16:21:15.000Z",
  "event": {
    "original": "192.0.2.42 - - [06/May/2099:16:21:15 +0000] \"GET /images/bg.jpg HTTP/1.0\" 200 24736"
  }
}
```

##### 搜索数据
DSL语法 : Domain Specific language,即特定领域专用语言
```json
GET logs-my_app-default/_search
{
  "query": {
    "match_all": {}
  },
  "sort": [
    {
      "@timestamp": "desc"
    }
  ]
}
```

##### 删除数据
```json
DELETE _data_stream/logs-my_app-default
```










